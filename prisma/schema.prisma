datasource db {
    provider = "mongodb"
    url      = env("DATABASE_URL")
}

generator client {
    provider = "prisma-client-js"
}

enum ILoginType {
    WatchOS
    HarmonyOS_Wearable
    Android
    Web
    IOS
}

enum ILoginMethod {
    QrCode
    PhoneCode
    EmailCode
    UsernamePassword
}

/// 权限库
model Permission {
    permissionID          String           @id @default(auto()) @map("_id") @db.ObjectId
    createdAt             DateTime         @default(now())
    updatedAt             DateTime         @updatedAt
    /// 权限的名称
    permissionName        String           @unique
    /// 权限的描述
    permissionDescription String?
    RolePermission        RolePermission[]
}

/// 角色拥有的权限列表
model RolePermission {
    rolePermissionID String     @id @default(auto()) @map("_id") @db.ObjectId
    createdAt        DateTime   @default(now())
    updatedAt        DateTime   @updatedAt
    /// 角色
    role             Role       @relation(fields: [roleID], references: [roleID])
    roleID           String     @db.ObjectId
    /// 权限
    permission       Permission @relation(fields: [permissionID], references: [permissionID])
    permissionID     String     @db.ObjectId
}

/// 角色
model Role {
    roleID          String           @id @default(auto()) @map("_id") @db.ObjectId
    createdAt       DateTime         @default(now())
    updatedAt       DateTime         @updatedAt
    /// 角色的名称
    roleName        String           @unique
    /// 角色的描述
    roleDescription String?
    /// 角色的权限
    RolePermission  RolePermission[]
    /// 角色的用户
    User            User?            @relation(fields: [userID], references: [userID])
    /// 角色的用户ID
    userID          String?          @db.ObjectId
}

/// 用户
model User {
    userID                String                  @id @default(auto()) @map("_id") @db.ObjectId
    createdAt             DateTime                @default(now())
    updatedAt             DateTime                @updatedAt
    /// 用户的用户名
    username              String                  @unique
    /// 用户的密码
    password              String?
    /// 用户的ip
    ip                    String?
    /// 用户的昵称
    saying                String?
    /// 用户的头像
    avatar                String?
    /// 用户的邮箱
    email                 String?
    /// 用户的手机号
    phone                 String?
    /// 用户是否被删除
    isDeleted             Boolean?                @default(false)
    /// 用户的登录标识符
    identifiers           UserIdentifier[]
    /// 用户的浏览器书签
    BrowserBookMark       BrowserBookMark[]
    /// 用户的浏览器足迹
    BrowserTrack          BrowserTrack[]
    /// 用户的App Store订阅
    UserAppStoreSubscribe UserAppStoreSubscribe[]
    /// 用户的角色
    roles                 Role[]
}

/// 用户登录标识符
model UserIdentifier {
    userIdentifierID String       @id @default(auto()) @map("_id") @db.ObjectId
    createdAt        DateTime     @default(now())
    updatedAt        DateTime     @updatedAt
    /// 登录设备类型
    loginType        ILoginType
    /// 登录的客户端 是哪个APP
    loginClient      String?
    /// 登录的设备名
    loginDeviceName  String?
    /// 登录的IP
    loginIP          String?
    /// 登录的渠道
    loginMethod      ILoginMethod
    /// 登录的标识符
    identifier       String?
    /// 登录的用户
    user             User         @relation(fields: [userID], references: [userID])
    /// 登录的用户ID
    userID           String       @db.ObjectId
}

/// 浏览器书签
model BrowserBookMark {
    browserBookMarkID String   @id @default(auto()) @map("_id") @db.ObjectId
    createdAt         DateTime @default(now())
    updatedAt         DateTime @updatedAt
    /// 标题
    bookMarkTitle     String
    /// 链接
    bookMarkLink      String
    /// 图标
    bookMarkIcon      String
    /// 颜色
    bookMarkColor     String
    /// 索引
    bookMarkIndex     Int
    /// 用户
    user              User     @relation(fields: [userID], references: [userID])
    /// 用户ID
    userID            String   @db.ObjectId
}

/// 浏览器足迹
model BrowserTrack {
    browserTrackID String   @id @default(auto()) @map("_id") @db.ObjectId
    createdAt      DateTime @default(now())
    updatedAt      DateTime @updatedAt
    /// 标题
    webPageTitle   String
    /// 链接
    webPageLink    String
    /// 用户
    user           User     @relation(fields: [userID], references: [userID])
    /// 用户ID
    userID         String   @db.ObjectId
}

/// 闪电：用户App Store订阅
model UserAppStoreSubscribe {
    userAppStoreSubscribeID String   @id @default(auto()) @map("_id") @db.ObjectId
    createdAt               DateTime @default(now())
    updatedAt               DateTime @updatedAt
    /// 原始交易ID
    originalTransactionID   String

    user   User   @relation(fields: [userID], references: [userID])
    userID String @db.ObjectId
}
